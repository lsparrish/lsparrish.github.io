<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mod 5 Drill</title>
<style>
*{box-sizing:border-box}
body{font-family:sans-serif;background:#1e293b;color:#f8fafc;margin:0;height:100vh;display:flex;align-items:center;justify-content:center}
.container{text-align:center;background:#0f172a;padding:40px;border-radius:15px}
.controls{margin-bottom:20px;display:flex;flex-direction:column;gap:15px}
.control-group{display:flex;align-items:center;justify-content:center;gap:15px}
.control-label{min-width:80px;text-align:right;font-size:14px;color:#cbd5e1}
.value-control{display:flex;align-items:center;gap:8px}
.instructions{max-width:300px;text-align:left;}
.btn,.value-display{border-radius:6px;padding:8px;display:flex;align-items:center;justify-content:center;font-weight:600}
.btn{background:#334155;border:none;color:#f8fafc;width:32px;height:32px;cursor:pointer;font-size:16px;user-select:none}
.btn:hover{background:#475569}
.btn:active{background:#1e293b}
.value-display{background:#1e293b;padding:8px 16px;min-width:60px;color:#3b82f6;border:1px solid #334155}
.problem{font-size:2.5em;font-weight:600;margin:15px 0;color:#fff}
.result{font-size:1.5em;min-height:40px;display:flex;align-items:center;justify-content:center;font-weight:500}
.correct{color:#22c55e}
.wrong{color:#ef4444}
.score{font-size:1.5em;margin-top:20px;color:#fff}
.streak{font-size:1.2em;margin-top:10px;color:#fbbf24}
.hidden{visibility:hidden}
.hint-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:10px;font-size:12px;color:#94a3b8;align-items:start}
.hint-table{border-collapse:collapse;justify-self:center}
.hint-table td{padding:4px 6px;text-align:center;font-family:monospace;border:1px solid #475569;width:24px;height:24px;transition:background-color .3s}
.hint-table caption{margin-bottom:5px;font-weight:600}
.highlight{background-color:#fbbf24!important;color:#000!important}
</style>
</head>
<body>
<div class="container">
<div class="controls" id="controls">
<div class="control-group">
<div class="control-label">Range:</div>
<div class="value-control">
<button class="btn" data-action="0">−</button>
<div class="value-display" id="range">6-9</div>
<button class="btn" data-action="1">+</button>
</div>
<div class="value-control">
<button class="btn" data-action="2">◄</button>
<button class="btn" data-action="3">►</button>
</div>
</div>
<div class="control-group">
<div class="control-label">Multiply:</div>
<div class="value-control">
<button class="btn" data-action="4">−</button>
<div class="value-display" id="mult">12</div>
<button class="btn" data-action="5">+</button>
</div>
</div>
</div>
<div class="problem" id="problem"></div>
<div class="result" id="result"></div>
<div class="score" id="score">Score: 0</div>
<div class="streak" id="streak">Streak: 0</div>
<div class="hint-container" id="hints"></div>
<div class="instructions" id="instructions">
Modulus 5 drill for improving your recall of multiplication facts.<br>
There are only 5 answers. However, 5 through 9 are equivalent to 0 through 4, so you can practice base 10.
Press T to toggle distracting details.<br>
Press H to switch between hint modes.<br>
Press I to hide instructions.<br>
Press . to toggle sound.<br>
Use ASDFG, ZXCVB, or number keys.</div>
</div>
<script>
let a,b,ans,score=0,minVal=5,width=3,mult=1,streak=0,prevA,prevB,hintMode=0,audioCtx,soundOn=1;

const $=id=>document.getElementById(id);
const sound=(freqs,dur=0.3,type='sine')=>{
    if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    const t=audioCtx.currentTime;
    if (!soundOn) return;
    freqs.forEach((f,i)=>{
        const o=audioCtx.createOscillator(),g=audioCtx.createGain();
        o.connect(g);g.connect(audioCtx.destination);
        o.frequency.value=f;o.type=type;
        g.gain.setValueAtTime(0.1,t);g.gain.exponentialRampToValueAtTime(0.01,t+dur);
        o.start(t+i*0.05);o.stop(t+dur);
    });
};

const update=()=>{
    $('range').textContent=`${minVal}`+", "+`${minVal+width}`;
    $('mult').textContent=mult;
};

const controlActions = (() => {
    const ranges = [[1,20], [1,10], [1,30]];
    const accessors = [
        (val) => val === undefined ? minVal : minVal = val,
        (val) => val === undefined ? width : width = val,
        (val) => val === undefined ? mult : mult = val
    ];

    const adj = (i, delta) => () => {
        const [min, max] = ranges[i];
        const newVal = accessors[i]() + delta;
        if (newVal >= min && newVal <= max) {
            accessors[i](newVal);
            update();
            newProblem();
        }
    };

    return ranges.flatMap((_, i) => [adj(i, -1), adj(i, +1)]);
})();

const highlight=()=>{
    document.querySelectorAll('.highlight').forEach(el=>el.classList.remove('highlight'));
    $('hints').classList.toggle('hidden',hintMode>=3);
    if(hintMode<2){
        const cell=document.querySelectorAll('.hint-table td')[(a%5)*6+(b%5)];
        cell&&cell.classList.add('highlight');
    }
    if(hintMode<1){
        [ans%5,ans%5+5].forEach(i=>{
            const cell=document.querySelectorAll('.hint-table')[1]?.querySelectorAll('td')[(i-1)%5];
            cell&&cell.classList.add('highlight');
        });
    }
};

const newProblem=()=>{
    do{a=Math.floor(Math.random()*(width+1))+minVal;b=mult}while(a===prevA&&b===prevB);
    prevA=a;prevB=b;ans=(a*b)%5;
    $('problem').textContent=`${a} × ${b}`;
    highlight();
};

const makeTable=(cap,data,cols)=>{
    let html=`<table class="hint-table"><caption>${cap}:</caption>`;
    for(let i=0;i<data.length;i+=cols){
        html+='<tr>';
        for(let j=0;j<cols&&i+j<data.length;j++)html+=`<td>${data[i+j]}</td>`;
        html+='</tr>';
    }
    return html+'</table>';
};

$('controls').onclick=e=>{
    const actionIndex = e.target.dataset.action;
    if(actionIndex !== undefined) {
        controlActions[parseInt(actionIndex)]();
    }
};

document.onkeydown=e=>{
    if (e.key.toUpperCase() === 'T') {
        ['instructions','controls','streak','result','score','hints']
            .forEach(id => document.getElementById(id)?.classList.toggle('hidden'));
        hintMode = 3;
        return;
    }
    if(e.key.toUpperCase()==='H'){
        hintMode=(hintMode+1)%4;
        highlight();
        return;
    }
    if(e.key.toUpperCase()==='I'){
        $('instructions').classList.add('hidden');
        highlight();
        return;
    }
    if(e.key==='.'){
        soundOn=0
        return;
    }
    const userAns='GASDFZXCVB0123456789'.indexOf(e.key.toUpperCase());
    if(userAns!==-1){
        if(userAns%5===ans){
            sound([261.63,329.63,392.00]);
            score++;streak++;
            $('score').textContent=`Score: ${score}`;
            $('streak').textContent=`Streak: ${streak}`;
            $('result').textContent='Correct!';
            if(streak%5===0){
                if(minVal<5){minVal++;update()}
                if(minVal>1){minVal--;width++;width++;update()}
                if(mult<20){mult++;update()} else {mult=1;width++}
            }
            newProblem();
        }else{
            sound([261.63, 293.66, 329.63]);
            streak=0;score--;
            $('result').textContent='Try again!';
            $('result').className='result wrong';
            $('streak').textContent=`Streak: ${streak}`;
        }
    }
};

$('hints').innerHTML=makeTable('%5 patterns','000000012340024130031420043210000000',6)+
                    makeTable('Equivalent Keys','1234567890ASDFGZXCVB',5);
update();
newProblem();
</script>
</body>
</html>
